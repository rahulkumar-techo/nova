name: ğŸš€ Next.js CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ğŸ§° Step 1: Checkout repository
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      # âš™ï¸ Step 2: Setup Node.js
      - name: ğŸ§© Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"

      # ğŸ“¦ Step 3: Install dependencies
      - name: ğŸ“¥ Install dependencies
        run: npm ci

      # ğŸ§¹ Step 4: Lint (optional)
      - name: ğŸ” Run ESLint
        run: npm run lint --if-present

      # ğŸ—ï¸ Step 5: Build Next.js app
      - name: ğŸ—ï¸ Build project
        run: npm run build

      # âœ… Step 6: Test (optional)
      - name: ğŸ§ª Run tests
        run: npm test --if-present

      # ğŸ§¾ Step 7: Upload build artifact (optional)
      - name: ğŸ“¤ Upload .next build output
        uses: actions/upload-artifact@v4
        with:
          name: next-build
          path: .next
  notify:
    name: ğŸ”” Notifications
    runs-on: ubuntu-latest
    if: always()

    steps:
      - name: ğŸ’¬ Telegram Notification
        run: |
          MESSAGE="ğŸš€ *NoteMentor CI/CD*%0AStatus: *${{ job.status }}*%0ABranch: \`${{ github.ref_name }}\`%0ACommit: \`${{ github.sha }}\`%0ABy: *${{ github.actor }}*%0AğŸ”— [View Logs](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})"
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d parse_mode="Markdown" \
          -d text="$MESSAGE"
